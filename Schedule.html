<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsive Layout with Top and Side Navigation</title>
  <link rel="stylesheet" href="style/index.css">
 
  <link rel="stylesheet" href="style/publish.css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
 

<!-- Add these lines inside the <head> tag of your HTML -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    

</head>
  
 
</head>
<body>

  <!-- Top Navigation -->
  <div class="top-nav">
    <span class="burger-icon" onclick="toggleNav()">â˜°</span>
    
   <script>
    // Function to extract URL parameters
    function getURLParameters() { 
    const params = {};
    const queryString = window.location.search.substring(1);
    const regex = /([^&=]+)=([^&]*)/g;
    let match;

    while (match = regex.exec(queryString)) {
        params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);
    }

    // Store parameters in session storage
    for (const key in params) {
        sessionStorage.setItem(key, params[key]);
    }

    // Retrieve user parameter, defaulting to 'Unknown user' if not provided
    const user = params.user || 'Unknown user';

    // Update the relevant HTML elements with the user information
    document.getElementById("users").textContent = user;
    document.getElementById("profile").textContent = user;

    // Return the params object if needed elsewhere
    return params;
}


    // Call the function when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', getURLParameters);
</script>


<div class="row_top">
    <div class="Welcomemsg">
      <label class="users">Hello, Mr. <span id="users"></span></label>
      <p class="text-gray">Welcome to Exam site</p>
    </div>
<div class="top_nav_content">
  
  <input type="search" class="searchbar" placeholder=" &#xF002; Search by exam title" style="font-family:Arial, FontAwesome" >
</div>

<div class="profile">
  <img src="source/Ellipse 1.svg" >
  <div class="userdetails">
  <label class="uname users"> <span id="profile"></span></label>
  <p class="text-gray">Student</p>
  </div>
</div>
</div>

  </div>

<!-- Side Navigation -->
<div class="side-nav" id="sideNav">
    <a href="#" id="homeLink" class="menulink">
        <svg xmlns="http://www.w3.org/2000/svg" class="homeicon" width="22" height="22" viewBox="0 0 22 22" fill="currentColor">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.82099 0.841828C10.0398 0.623112 10.3365 0.500244 10.6458 0.500244C10.9552 0.500244 11.2519 0.623112 11.4707 0.841828L18.4707 7.84183L20.804 10.1752C21.0165 10.3952 21.1341 10.6899 21.1314 10.9958C21.1288 11.3017 21.0061 11.5943 20.7898 11.8106C20.5735 12.0269 20.2808 12.1496 19.975 12.1523C19.6691 12.1549 19.3744 12.0373 19.1543 11.8248L18.8125 11.483V19.1667C18.8125 19.7855 18.5667 20.379 18.1291 20.8166C17.6915 21.2542 17.098 21.5 16.4792 21.5H12.9792C12.6697 21.5 12.373 21.3771 12.1542 21.1583C11.9354 20.9395 11.8125 20.6427 11.8125 20.3333V16.8333H9.47915V20.3333C9.47915 20.6427 9.35624 20.9395 9.13744 21.1583C8.91865 21.3771 8.62191 21.5 8.31249 21.5H4.81249C4.19365 21.5 3.60016 21.2542 3.16257 20.8166C2.72499 20.379 2.47915 19.7855 2.47915 19.1667V11.483L2.13732 11.8248C1.91728 12.0373 1.62258 12.1549 1.31669 12.1523C1.01079 12.1496 0.718175 12.0269 0.501865 11.8106C0.285556 11.5943 0.162859 11.3017 0.1602 10.9958C0.157542 10.6899 0.275136 10.3952 0.487653 10.1752L2.82099 7.84183L9.82099 0.841828Z" />
        </svg>
        &nbsp;Home
    </a>
    
    <a href="#" id="scheduleLink" class="menulink" style="text-align: center;">
        <svg xmlns="http://www.w3.org/2000/svg" class="homeicon" width="29" height="28" viewBox="0 0 29 28" fill="none">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.04628 2.79999C8.30367 2.79999 7.59148 3.09499 7.06638 3.62009C6.54128 4.14519 6.24628 4.85738 6.24628 5.59999V22.4C6.24628 23.1426 6.54128 23.8548 7.06638 24.3799C7.59148 24.905 8.30367 25.2 9.04628 25.2H20.2463C20.9889 25.2 21.7011 24.905 22.2262 24.3799C22.7513 23.8548 23.0463 23.1426 23.0463 22.4V10.3796C23.0461 9.63704 22.751 8.92497 22.2259 8.39999L17.4463 3.62039C16.9213 3.09525 16.2092 2.80015 15.4667 2.79999H9.04628ZM11.8463 16.8C11.8463 16.4287 11.6988 16.0726 11.4362 15.81C11.1737 15.5475 10.8176 15.4 10.4463 15.4C10.075 15.4 9.71888 15.5475 9.45633 15.81C9.19378 16.0726 9.04628 16.4287 9.04628 16.8V21C9.04628 21.3713 9.19378 21.7274 9.45633 21.9899C9.71888 22.2525 10.075 22.4 10.4463 22.4C10.8176 22.4 11.1737 22.2525 11.4362 21.9899C11.6988 21.7274 11.8463 21.3713 11.8463 21V16.8ZM14.6463 12.6C15.0176 12.6 15.3737 12.7475 15.6362 13.01C15.8988 13.2726 16.0463 13.6287 16.0463 14V21C16.0463 21.3713 15.8988 21.7274 15.6362 21.9899C15.3737 22.2525 15.0176 22.4 14.6463 22.4C14.275 22.4 13.9189 22.2525 13.6563 21.9899C13.3938 21.7274 13.2463 21.3713 13.2463 21V14C13.2463 13.6287 13.3938 13.2726 13.6563 13.01C13.9189 12.7475 14.275 12.6 14.6463 12.6ZM20.2463 11.2C20.2463 10.8287 20.0988 10.4726 19.8362 10.21C19.5737 9.94749 19.2176 9.79999 18.8463 9.79999C18.475 9.79999 18.1189 9.94749 17.8563 10.21C17.5938 10.4726 17.4463 10.8287 17.4463 11.2V12.6C17.4463 12.9713 17.5938 13.3274 17.8563 13.5899C18.1189 13.8525 18.475 14 18.8463 14C19.2176 14 19.5737 13.8525 19.8362 13.5899C20.0988 13.3274 20.2463 12.9713 20.2463 12.6V11.2Z" fill="#999999" />
        </svg>
        &nbsp;Schedule
    </a>
  
    <script>

        // Function to extract URL parameters and store in session storage
  
        function getURLParameters() { 
  
            const params = {};
  
            const queryString = window.location.search.substring(1);
  
            const regex = /([^&=]+)=([^&]*)/g;
  
            let match;
  
      
  
            while (match = regex.exec(queryString)) {
  
                params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);
  
            }
  
      
  
            // Store parameters in session storage
  
            Object.keys(params).forEach(key => {
  
                sessionStorage.setItem(key, params[key]);
  
            });
  
      
  
            // Return parameters for immediate usage
  
            return params;
  
        }
  
      
  
        function populateLinks() {
  
            const params = getURLParameters();
  
            const studentClass = params.class || 'Unknown Class';
  
            const rollno = params.rollno || 'Unknown Roll Number';
  
            const user = params.user || 'Unknown User';
  
      
  
            // Set link hrefs dynamically
  
            const homeLink = document.getElementById('homeLink');
  
            const scheduleLink = document.getElementById('scheduleLink');
  
      
  
            if (homeLink && scheduleLink) {
  
                homeLink.href = `studentdashboard.html?class=${studentClass}&rollno=${rollno}&user=${user}`;
  
                scheduleLink.href = `Schedule.html?class=${studentClass}&rollno=${rollno}&user=${user}`;
  
            } else {
  
                console.warn("Links not found. Ensure elements have correct IDs.");
  
            }
  
        }
  
      
  
        // Use DOMContentLoaded to ensure elements are ready
  
        document.addEventListener("DOMContentLoaded", populateLinks);
  
      </script>
    
    
  
  <img class="sidenavbanner" src="source/studentimg.png" style="width: 100%;">
  
  </div>

  
  </script>
 

  
  <style>
    .sidenavbanner{
      width: 100%;
      position: absolute;
      bottom: 60px;
    }
  </style>

  <style>
.sub_name{
    position: relative;
    left: 20px;
    top: 35px;
    color: #FFF;
    font-family: Poppins;
    font-size: 32px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;text-align: start !important;
}

.subject_head {
    width: 269px;
    height: 85px;
    flex-shrink: 0;
    border-radius: 14px;
    background-color: #00535E;
    text-align: start !important;
    position: relative;
    top: -15px;
    left: -15px;
}

    h2{
        color: #000;
font-family: Poppins;
font-size: 16px;
font-style: normal;
font-weight: 600;
line-height: normal;
    }
  </style>
  <div class="main-content">
  <div class="side_head">
    <h2>New Test</h2> 
  </div>

  <div class="slick_container responsive" id="dataContainer"></div>


 <!-- Add this before your script if jQuery isn't already included -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



<script>

  
///////////time validator///////////////
const examTimeValidator = () => {
    const timerange = sessionStorage.getItem('TimeRange');
    

    if (!timerange) return false; // If no TimeRange is available, return false

    const [startTime, endTime] = timerange.split('-');

    const currentDate = new Date().toISOString().split('T')[0]; // Get current date (YYYY-MM-DD)

    // const isoString = sessionStorage.getItem('ExamDate');
    const isoString = "2024-11-08T18:30:00.000Z"
    if (!isoString) return false; // If no ExamDate is available, return false

    const date = new Date(isoString);
    const formattedDate = date.toISOString().split('T')[0]; // Get formatted date (YYYY-MM-DD)

    // Function to get current time in hh:mm format
    function getCurrentTime() {
        const now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();

        // Pad hours and minutes with leading zeros if needed
        hours = hours < 10 ? '0' + hours : hours;
        minutes = minutes < 10 ? '0' + minutes : minutes;

        return `${hours}:${minutes}`;
    }

    // Convert time (hh:mm) to minutes
    function timeToMinutes(time) {
        const [hours, minutes] = time.split(":").map(Number);
        return hours * 60 + minutes;
    }

    const currentTimeInMinutes = timeToMinutes(getCurrentTime());
    // const startTimeInMinutes = timeToMinutes(startTime);
    //     const endTimeInMinutes = timeToMinutes(endTime);

    const startTimeInMinutes = timeToMinutes("17:00");
    const endTimeInMinutes = timeToMinutes("18:00");


    // Check if current date is exam date and current time is within the range
    return currentDate === formattedDate && currentTimeInMinutes >= startTimeInMinutes && currentTimeInMinutes < endTimeInMinutes;
};


function getURLParameters() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const regex = /([^&=]+)=([^&]*)/g;
            let match;

            while (match = regex.exec(queryString)) {
                params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);
            }

            return params;
        }


        async function saveTutorialResults() {
       try {
             // Get parameters and display them
             const params = getURLParameters();
        const studentClass = params.class || 'Unknown Class';
        const rollno = params.rollno || 'Unknown Roll Number';
        
        const response = await fetch(`http://localhost:8000/api/tutorials/examcomplete?rollnumber=${rollno}&class=${selectedClass}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        });

        if (!response.ok) {
            throw new Error('Failed to retrieve tutorial results: ' + response.statusText);
        }

        const result = await response.json();
      debugger;

        // Call the function to open the popup and display the score
        openPopup(score);
        console.log('Tutorial results retrieved successfully:', result);
    } catch (error) {
        console.error('Error retrieving tutorial results:', error);
    }
}

// async function fetchDataAndPopulate() {
//     try {
//         const params = getURLParameters();
//         const studentClass = params.class || 'Unknown Class';
//         const rollno = params.rollno || 'Unknown Roll Number';
//         const user = params.user || 'Unknown Roll Number';
        
//         const response = await fetch(`http://localhost:8000/api/tutorials?class=${studentClass}`);
        
//         if (!response.ok) {
//             throw new Error(`HTTP error! Status: ${response.status}`);
//         }
        
//         const data = await response.json();

//         if (!Array.isArray(data) || data.length === 0) {
//             const container = document.getElementById('dataContainer');
//             if (container) {
//                 container.innerHTML = '<div class="no-data">No Data Available</div>';
//                 const noDataElement = container.querySelector('.no-data');
//                 noDataElement.style.textAlign = 'center';
//                 noDataElement.style.fontSize = '18px';
//                 noDataElement.style.color = '#888';
//             }
//             return;
//         }

//         const container = document.getElementById('dataContainer');
//         if (container) {
//             container.innerHTML = '';

//             data.forEach(item => {
//                 const container_1 = document.createElement('div');
//                 container_1.className = 'container_1';

//                 const subjectBox = document.createElement('div');
//                 subjectBox.className = 'Subject_box';

//                 const rawExamDate = item.ExamDate;
//                 const examDate = new Date(rawExamDate);
//                 const formattedExamDate = examDate.toLocaleString('en-US', {
//                     year: 'numeric',
//                     month: 'long',
//                     day: 'numeric'
//                 });

//                 // Here we filter based on subject and exam title
//                 const subject = item.Subject; // Replace with the actual subject you're interested in
//                 const examTitle = item.title; // Replace with the actual exam title you're interested in

//                 const filteredData = data.filter(item => item.Subject === subject && item.title === examTitle);

//                 if (filteredData.length === 0) {
//                     console.error("No data found for the specified subject and exam title.");
//                     return; // Or handle the case when no matching data is found
//                 }

//                 // Store the first matched item's details
//                 const selectedExam = filteredData[0];
//                 sessionStorage.setItem('examtitel', selectedExam.title);          
//                 sessionStorage.setItem('TimeRange', selectedExam.TimeRange);
//                 sessionStorage.setItem('Subject', selectedExam.Subject);

//                 // Get the TimeRange from session storage (e.g., "19:35-20:05")
//                 const timeRange = sessionStorage.getItem('TimeRange');

//                 // Function to check if the current time is within the given range
//                 function isTimeInRange(timeRange) {
//                     if (!timeRange) return false;

//                     // Split the time range into start and end times
//                     const [start, end] = timeRange.split('-');
                    
//                     // Parse start and end times
//                     const startTime = new Date();
//                     const endTime = new Date();
//                     const [startHour, startMinute] = start.split(':').map(Number);
//                     const [endHour, endMinute] = end.split(':').map(Number);

//                     startTime.setHours(startHour, startMinute, 0, 0);
//                     endTime.setHours(endHour, endMinute, 0, 0);

//                     // Get the current time
//                     const currentTime = new Date();

//                     // Return true if the current time is within the range
//                     return currentTime >= startTime && currentTime <= endTime;
//                 }

//                 const isExamTimeValid = isTimeInRange(timeRange);

//                 // Process the filtered data to get the questions and options
//                 const processedData = filteredData.map(item => {
//                     return item.questions.map((question, index) => ({
//                         question,
//                         options: item.options[index],
//                     }));
//                 }).flat();

//                 // Clear the session storage and store the filtered data
            
//                         sessionStorage.setItem('uploadedContent', JSON.stringify(processedData));
//                 // Set up the link to view questions based on the time range validity
//                 const subjectLink = `studentquestion.html?class=${studentClass}&rollno=${rollno}&user=${user}&subject=${item.Subject}&examTitle=${item.title}`;
//                 let viewQuestionElement;

//                 // If the exam time is invalid, show alert and change the link to "Please wait..."
//                 if (!isExamTimeValid) {
//                     alertify.alert(
//                         `<div style="display: flex; align-items: center;">
//                             <img src="https://img.icons8.com/emoji/48/000000/warning-emoji.png" alt="Alert Icon" style="width: 24px; height: 24px; margin-right: 8px;">
//                             <span>Please check with the exam scheduled time.</span>
//                         </div>`
//                     )
//                     .setHeader("Alert") // Set custom header title here
//                     .setting({
//                         'onok': function() {
//                             console.log("Alert dismissed");
//                         }
//                     });

//                     // Display "Please wait..." instead of the link
//                     viewQuestionElement = `<p class="disabled">Please wait...</p>`;
//                 } else {
//                     // If the exam time is valid, show the link to view questions
//                     viewQuestionElement = `<a href="${subjectLink}">View question</a>`;
//                 }

//                 // Update the subject box HTML
//                 subjectBox.innerHTML = `
//                     <div class="subject_content">
//                         <div class="subject_head">
//                             <span class="sub_name">${item.Subject}</span>
//                         </div>
//                         <div class="test_info">
//                             <div class="test_name">${item.title}</div>
//                             <div class="test_duration">${item.TimeRange}</div>
//                         </div>
//                         <div class="test_date">
//                             <img src="source/Rectangle 32.png" alt="Test Date"> ${formattedExamDate}
//                         </div>
//                         <div class="view_sub">
//                             ${viewQuestionElement}
//                         </div>
//                     </div>
//                 `;

//                 sessionStorage.setItem('ExamDate', formattedExamDate);
//                 container_1.appendChild(subjectBox);
//                 container.appendChild(container_1);
//             });

//             $(container).slick('unslick');
//             const slidesToShow = Math.min(Math.max(data.length, 1), 4);
//             $(container).slick({
//                 infinite: true,
//                 slidesToShow,
//                 slidesToScroll: 1,
//                 dots: true,
//                 arrows: true
//             });
//         } else {
//             console.error('Element with ID "dataContainer" not found.');
//         }
//     } catch (error) {
//         console.error('Error fetching data:', error);
//     }
// }


async function fetchDataAndPopulate() {
    try {
        const params = getURLParameters();
        const studentClass = params.class || 'Unknown Class';
        const rollno = params.rollno || 'Unknown Roll Number';
        const user = params.user || 'Unknown Roll Number';
        
        const response = await fetch(`http://localhost:8000/api/tutorials?class=${studentClass}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();

        if (!Array.isArray(data) || data.length === 0) {
            const container = document.getElementById('dataContainer');
            if (container) {
                container.innerHTML = '<div class="no-data">No Data Available</div>';
                const noDataElement = container.querySelector('.no-data');
                noDataElement.style.textAlign = 'center';
                noDataElement.style.fontSize = '18px';
                noDataElement.style.color = '#888';
            }
            return;
        }

        const container = document.getElementById('dataContainer');
        if (container) {
            container.innerHTML = '';

            data.forEach(item => {
                const container_1 = document.createElement('div');
                container_1.className = 'container_1';

                const subjectBox = document.createElement('div');
                subjectBox.className = 'Subject_box';

                const rawExamDate = item.ExamDate;
                const examDate = new Date(rawExamDate);
                const formattedExamDate = examDate.toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Filter based on subject and exam title
                const subject = item.Subject;
                const examTitle = item.title;
                const filteredData = data.filter(item => item.Subject === subject && item.title === examTitle);

                if (filteredData.length === 0) {
                    console.error("No data found for the specified subject and exam title.");
                    return; 
                }

                const selectedExam = filteredData[0];
                sessionStorage.setItem('examtitel', selectedExam.title);
                sessionStorage.setItem('TimeRange', selectedExam.TimeRange);
                sessionStorage.setItem('Subject', selectedExam.Subject);

                const timeRange = sessionStorage.getItem('TimeRange');

                function isTimeInRange(timeRange) {
                    if (!timeRange) return false;

                    const [start, end] = timeRange.split('-');
                    const startTime = new Date();
                    const endTime = new Date();
                    const [startHour, startMinute] = start.split(':').map(Number);
                    const [endHour, endMinute] = end.split(':').map(Number);

                    startTime.setHours(startHour, startMinute, 0, 0);
                    endTime.setHours(endHour, endMinute, 0, 0);

                    const currentTime = new Date();
                    return currentTime >= startTime && currentTime <= endTime;
                }

                const isExamTimeValid = isTimeInRange(timeRange);
 // Process the filtered data to get the questions and options
                const processedData = filteredData.map(item => {
                    return item.questions.map((question, index) => ({
                        question,
                        options: item.options[index],
                    }));
                }).flat();

                // Clear the session storage and store the filtered data
            
                        sessionStorage.setItem('uploadedContent', JSON.stringify(processedData));
                let viewQuestionElement;
                if (!isExamTimeValid) {
                    viewQuestionElement = `<p class="disabled">0 marks</p>`; // Display 0 marks if time is up
                } else {
                    const subjectLink = `studentquestion.html?class=${studentClass}&rollno=${rollno}&user=${user}&subject=${item.Subject}&examTitle=${item.title}`;
                    viewQuestionElement = `<a href="${subjectLink}">View question</a>`;
                }

                subjectBox.innerHTML = `
                    <div class="subject_content">
                        <div class="subject_head">
                            <span class="sub_name">${item.Subject}</span>
                        </div>
                        <div class="test_info">
                            <div class="test_name">${item.title}</div>
                            <div class="test_duration">${item.TimeRange}</div>
                        </div>
                        <div class="test_date">
                            <img src="source/Rectangle 32.png" alt="Test Date"> ${formattedExamDate}
                        </div>
                        <div class="view_sub">
                            ${viewQuestionElement}
                        </div>
                    </div>
                `;

                sessionStorage.setItem('ExamDate', formattedExamDate);
                container_1.appendChild(subjectBox);
                container.appendChild(container_1);
            });

            $(container).slick('unslick');
            const slidesToShow = Math.min(Math.max(data.length, 1), 4);
            $(container).slick({
                infinite: true,
                slidesToShow,
                slidesToScroll: 1,
                dots: true,
                arrows: true
            });
        } else {
            console.error('Element with ID "dataContainer" not found.');
        }
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}




async function fetchDataAndPopulatecomplete() {
    try {

    
        const params = getURLParameters();
        const studentClass = params.class || 'Unknown Class';
        const rollno = params.rollno || 'Unknown Roll Number';

        const response = await fetch(`http://localhost:8000/api/tutorials/studentexamstatus?class=${studentClass}&rollno=${rollno}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();

        const container = document.querySelector('#completed');
        container.innerHTML = '';

        data.forEach(item => {
            const container_1 = document.createElement('div');
            container_1.className = 'container_1';

            const subjectBox = document.createElement('div');
            subjectBox.className = 'Subject_box';

            const rawExamDate = item.examdate;
            const examDate = new Date(rawExamDate);
            const formattedExamDate = examDate.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Determine the content based on the mark
            let progressContent;
            if (item.mark === "Not yet calculated") {
                progressContent = `<div class="not-calculated">Mark: Not yet calculated</div>`;
            } else {
                const progressClass = item.mark < 30 ? 'progress-low' : 'progress-normal';
                progressContent = `
                    <div class="progress">
                       <span class="title timer" data-from="0" data-to="${item.mark.toString().slice(0, 2)}" data-speed="1800">${item.mark.toString().slice(0, 2)}</span>
                        <div class="overlay"></div>
                        <div class="left ${progressClass}"></div>
                        <div class="right ${progressClass}"></div>
                    </div>
                `;
            }

            subjectBox.innerHTML = `
                <div class="subject_content">
                    <div class="subject_head">
                        <span class="sub_name">${item.subject || 'Subject'}</span>
                    </div>
                    <div class="test_info">
                        <div class="test_name">${item.testname || 'Test name not available'}</div>
                        <div class="test_duration">${item.duration || 'Duration not available'}</div>
                    </div>
                    <div class="test_date"><img src="source/Rectangle 32.png" alt="Test Date"> ${formattedExamDate}</div>
                    ${progressContent}  <!-- Insert the progress content -->
                </div>
            `;

            container_1.appendChild(subjectBox);
            container.appendChild(container_1);
        });
    } catch (error) {
        console.error('Error populating data:', error);
    }
}


// async function fetchDataAndPopulatecomplete() {
//     try {
//         const params = getURLParameters();
//         const studentClass = params.class || 'Unknown Class';
//         const rollno = params.rollno || 'Unknown Roll Number';

//         const response = await fetch(`http://localhost:8000/api/tutorials/studentexamstatus?class=${studentClass}&rollno=${rollno}`);
        
//         if (!response.ok) {
//             throw new Error(`HTTP error! Status: ${response.status}`);
//         }
        
//         const data = await response.json();

//         // Sort data by exam date and time in ascending order (oldest to newest)
//         data.sort((a, b) => {
//             const dateA = new Date(a.examdate);
//             const dateB = new Date(b.examdate);
//             return dateA - dateB;
//         });

//         const container = document.querySelector('#completed');
//         container.innerHTML = '';

//         data.forEach(item => {
//             const container_1 = document.createElement('div');
//             container_1.className = 'container_1';

//             const subjectBox = document.createElement('div');
//             subjectBox.className = 'Subject_box';

//             const rawExamDate = item.examdate; // Exam date in "YYYY-MM-DD" format
//             const examDate = new Date(rawExamDate); // Convert to Date object

//             const formattedExamDate = examDate.toLocaleString('en-US', {
//                 year: 'numeric',
//                 month: 'long',
//                 day: 'numeric',
//                 hour: 'numeric',
//                 minute: 'numeric',
//                 second: 'numeric',
//                 hour12: true
//             });

//             // Extract time range from item.TimeRange (e.g., "18:57-19:21")
//             const timeRange = item.TimeRange || '';
//             let startTime = '';
//             let endTime = '';

//             if (timeRange) {
//                 const [start, end] = timeRange.split('-');
//                 const [startHours, startMinutes] = start.split(':');
//                 const [endHours, endMinutes] = end.split(':');

//                 // Combine the date with start time and end time to create Date objects
//                 const startTimeDate = new Date(examDate);
//                 startTimeDate.setHours(startHours, startMinutes);

//                 const endTimeDate = new Date(examDate);
//                 endTimeDate.setHours(endHours, endMinutes);

//                 // Format start and end time for display
//                 startTime = startTimeDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
//                 endTime = endTimeDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
//             }

//             // Function to check if the current time is after the exam date
//             function isExamExpired(examDate) {
//                 const currentTime = new Date();
//                 return currentTime > examDate; // Return true if the exam time has passed
//             }

//             // If the exam time has passed, display a "0" mark or a specific message
//             let progressContent;
//             if (isExamExpired(examDate)) {
//                 progressContent = `<div class="not-calculated">Exam expired</div>`;
//             } else if (item.mark === "Not yet calculated") {
//                 progressContent = `<div class="not-calculated">Mark: Not yet calculated</div>`;
//             } else {
//                 const progressClass = item.mark < 30 ? 'progress-low' : 'progress-normal';
//                 progressContent = `
//                     <div class="progress">
//                        <span class="title timer" data-from="0" data-to="${item.mark.toString().slice(0, 2)}" data-speed="1800">${item.mark.toString().slice(0, 2)}</span>
//                         <div class="overlay"></div>
//                         <div class="left ${progressClass}"></div>
//                         <div class="right ${progressClass}"></div>
//                     </div>
//                 `;
//             }

//             subjectBox.innerHTML = `
//                 <div class="subject_content">
//                     <div class="subject_head">
//                         <span class="sub_name">${item.subject || 'Subject'}</span>
//                     </div>
//                     <div class="test_info">
//                         <div class="test_name">${item.testname || 'Test name not available'}</div>
//                         <div class="test_duration">${item.duration || 'Duration not available'}</div>
//                     </div>
//                     <div class="test_date"><img src="source/Rectangle 32.png" alt="Test Date"> ${formattedExamDate} from ${startTime} to ${endTime}</div>
//                     ${progressContent}  <!-- Insert the progress content -->
//                 </div>
//             `;

//             container_1.appendChild(subjectBox);
//             container.appendChild(container_1);
//         });
//     } catch (error) {
//         console.error('Error populating data:', error);
//     }
// }


// function hideDuplicateTests() {
//     const dataContainer = document.querySelector("#dataContainer");
//     const dataContainerTests = dataContainer.querySelectorAll(".container_1");
//     const completedTests = document.querySelectorAll("#completed .container_1");

//     // Track if any tests remain visible after filtering
//     let visibleTestCount = dataContainerTests.length;

//     // Loop through each test in the completed section
//     completedTests.forEach(completedTest => {
//         const completedTestName = completedTest.querySelector(".test_name").innerText.trim().toLowerCase();
//         const completedTestDate = completedTest.querySelector(".test_date").innerText.trim();

//         // Compare with each test in dataContainer
//         dataContainerTests.forEach(dataContainerTest => {
//             const dataTestName = dataContainerTest.querySelector(".test_name").innerText.trim().toLowerCase();
//             const dataTestDate = dataContainerTest.querySelector(".test_date").innerText.trim();

//             // Hide if both name and date match
//             if (completedTestName === dataTestName && completedTestDate === dataTestDate) {
//                 dataContainerTest.style.display = "none";
//                 visibleTestCount--; // Decrease count of visible tests
//             }
//         });
//     });

//     // If no tests are visible, add "No data found" message
//     if (visibleTestCount === 0) {
//         const noDataMessage = document.createElement("div");
//         noDataMessage.className = "no-data-message";
//         noDataMessage.innerHTML = "No data found";
//         dataContainer.appendChild(noDataMessage);
//     }
// }
function hideDuplicateTests() {
    const dataContainer = document.querySelector("#dataContainer");
    const dataContainerTests = dataContainer.querySelectorAll(".container_1");
    const completedTests = document.querySelectorAll("#completed .container_1");

    // Track if any tests remain visible after filtering
    let visibleTestCount = dataContainerTests.length;

    completedTests.forEach(completedTest => {
        const completedTestName = completedTest.querySelector(".test_name").innerText.trim().toLowerCase();
        const completedTestDate = new Date(completedTest.querySelector(".test_date").innerText.trim()).toDateString();
        const completedTestSubject = completedTest.querySelector(".sub_name").innerText.trim().toLowerCase();  // Adjusted for subject

        dataContainerTests.forEach(dataContainerTest => {
            const dataTestName = dataContainerTest.querySelector(".test_name").innerText.trim().toLowerCase();
            const dataTestDate = new Date(dataContainerTest.querySelector(".test_date").innerText.trim()).toDateString();
            const dataTestSubject = dataContainerTest.querySelector(".sub_name").innerText.trim().toLowerCase(); // Adjusted for subject

            // Hide only if name, subject, and date all match
            if (completedTestName === dataTestName && completedTestDate === dataTestDate && completedTestSubject === dataTestSubject) {
                dataContainerTest.style.display = "none";
                visibleTestCount--; // Decrease count of visible tests
            }
        });
    });

    // If no tests are visible, add "No data found" message
    if (visibleTestCount === 0) {
        const noDataMessage = document.createElement("div");
        noDataMessage.className = "no-data-message";
        noDataMessage.innerHTML = "No data found";
        dataContainer.appendChild(noDataMessage);
    }
}


document.addEventListener('DOMContentLoaded', async () => {
    await Promise.all([fetchDataAndPopulate(), fetchDataAndPopulatecomplete()]);
    hideDuplicateTests();
});


</script>
  

<style>

.not-calculated{
    text-align: end;
    font-size: 12px;
    position: relative;
    bottom: -50px;
    color: gray;
    font-weight: 500;
    font-family: Poppins;
}

.no-data-message {
    text-align: center;
    color: #666;
    font-size: 1.2em;
    margin-top: 10px;
    position: relative;
    left: 500px;
    padding: 20px;
}

</style>

<style>
    .alertify .ajs-header {
      color: #ffffff !important;
      font-weight: 700;
      background: #123c41 !important;
      border-bottom: #eee 1px solid;
      border-radius: 2px 2px 0 0;
  }
  .alertify .ajs-dialog {
    position: relative;
    margin: 5% auto;
    min-height: 110px;
    max-width: 500px;
    padding: 24px 24px 0 24px;
    outline: 0;
    background-color: #fff;
    z-index: 99999999;
}
  </style>
    <div class="side_head">
      <h2>Completed Exams</h2> 
    </div>
<div class="slick_container  responsive" id="completed">
  
</div>

  </div>
 <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Slick JS -->
<script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>



<script>
    // Get all elements with the class "view_sub"
    const viewSubElements = document.getElementsByClassName("view_sub");
    const params = getURLParameters();
        const studentClass = params.class || 'Unknown Class';
        const rollno = params.rollno || 'Unknown Roll Number';
        const user = params.user || 'Unknown Roll Number';
    // Loop through each element and attach a click event listener
    for (let i = 0; i < viewSubElements.length; i++) {
      viewSubElements[i].addEventListener("click", function() {
        window.location.href = `studentquestion.html?class=${studentClass}&rollno=${rollno}&user=${user}`; // Replace with your target URL
      });
    }
  </script>
  
  <style>

.view_sub a{
    text-decoration: none !important;
    color: #F6F6F6 !important;
}

.slick_container  {
    display: flex;
}
.view_sub{
    position: relative;
    top: 40px;
    left: 137px;
    width: 100px;
    height: 30px;
    flex-shrink: 0;
    border-radius: 6px;
    background: linear-gradient(0deg, #00535E 0%, #00535E 100%), #D9D9D9;
    text-align: center;
    color: #fff;
    padding: 8px;
    font-family: Poppins;
    font-size: 10px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
    cursor: pointer;
}

.test_info{
    display: flex;
    justify-content: space-between;
}

.test_duration{
    color: #00535E;
    font-family: Poppins;
    font-size: 10px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
}

.subject_head {
    width: 269px;
    height: 85px;
    flex-shrink: 0;
    border-radius: 14px;
    background-color: #00535E;
    text-align: center;
    position: relative;
    top: -15px;
    left: -15px;
}
.subject_content {
    border: 1px solid #DCDCDC;
    background-color: #F6F6F6;
    width: 270px;
    height: 240px;
    flex-shrink: 0;
    border-radius: 14px;
    padding: 15px;
}

    .side_head{
        margin: 10px;
        padding: 5px;
    }

    .container_1{
        margin: 15px;
    }
    .Subject_box{
        margin: 10px;
    }

    .test_name{
        color: #000;
font-family: Poppins;
font-size: 20px;
font-style: normal;
font-weight: 500;
line-height: normal;
    }

    .test_date{
       
    color: #696767;
    font-family: Poppins;
    font-size: 10px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
    display: flex;
    gap: 8px;
    }
    .dateico {
    color: #696767;
    fill: #696767;
    width: 12px;
}
  </style>

<style>

    .no-data{
        text-align: center;
    font-size: 18px;
    color: rgb(136, 136, 136);
    padding: 20px;
    margin: 20px;
    width: 100%;
    }
    .progress {
    width: 50px;
    height: 50px;
    font-size: 14px; /* Adjusted for 50px size */
    color: #fff;
    border-radius: 50%;
    overflow: hidden;
    position: relative;
    background: #fff;
    text-align: center;
    line-height: 50px;
    margin: 10px;
    left: 170px;
}

.progress::after {
    content: "%";
    font-size: 12px; /* Adjusted for 50px size */
}

.progress .title {
    position: relative;
    z-index: 100;
    left: 18px;
    color: #00535E;
}

.progress .overlay {
    width: 50%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    background-color: #fff;
}

.progress .left, .progress .right {
    width: 50%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    border: 6px solid; /* Removed fixed color to set in the individual classes */
    border-radius: 25px 0 0 25px;
    border-right: 0;
    transform-origin: right;
}

.progress-low {
    border-color: red !important; /* Color for low progress */
}

.progress-normal {
    border-color: #00535E !important ; /* Color for normal progress */
}

.progress .left {
    animation: load1 1s linear forwards;
}

.progress:nth-of-type(2) .right,
.progress:nth-of-type(3) .right {
    animation: load2 0.5s linear forwards 1s;
}

.progress:last-of-type .right,
.progress:first-of-type .right {
    animation: load3 0.8s linear forwards 1s;
}

@keyframes load1 {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(180deg);
    }
}

@keyframes load2 {
    0% {
        z-index: 100;
        transform: rotate(180deg);
    }
    100% {
        z-index: 100;
        transform: rotate(270deg);
    }
}

@keyframes load3 {
    0% {
        z-index: 100;
        transform: rotate(180deg);
    }
    100% {
        z-index: 100;
        transform: rotate(315deg);
    }
}

    </style>
  
</body>
<!-- <script type="text/javascript">
    $(document).ready(function() {
        $('.slick_container').slick({
            infinite: true, // Enable infinite scrolling
            slidesToShow: 4, // Number of slides to show
            slidesToScroll: 1, // Number of slides to scroll
            dots: true, // Show dots for navigation
            arrows: true // Show arrows for navigation
        });
    });
</script> -->

</html>
